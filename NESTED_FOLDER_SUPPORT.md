# 音频转录与总结工具 - 嵌套文件夹支持

本工具现在支持选择嵌套文件夹，并在输出时保持源文件夹结构。

## 功能特点

1. **递归扫描**：可以扫描指定文件夹及其所有子文件夹中的音频文件
2. **保持文件夹结构**：在输出文件夹中保持与源文件夹相同的目录结构
3. **GUI界面支持**：图形界面支持选择嵌套文件夹
4. **命令行支持**：命令行模式也支持保持文件夹结构
5. **批处理脚本**：提供了专门的批处理脚本用于处理大量文件

## 使用方法

### GUI界面

1. 启动图形界面：
   ```
   python main.py --gui
   ```

2. 在界面中：
   - 选择"文件夹"模式
   - 点击"浏览"按钮选择包含音频文件的根文件夹
   - 工具会自动递归扫描所有子文件夹中的音频文件
   - 选择输出文件夹
   - 配置转录和总结选项
   - 点击"开始转录"按钮

3. 输出结果：
   - 转录文件保存在 `输出文件夹/transcripts/` 下
   - 总结文件保存在 `输出文件夹/summaries/` 下
   - 文件夹结构与源文件夹保持一致

### 命令行模式

1. 处理单个文件：
   ```
   python src/core/audio_summarizer.py --audio path/to/audio.mp3 --output path/to/output
   ```

2. 处理文件并保持源文件夹结构：
   ```
   python src/core/audio_summarizer.py --audio path/to/source_folder/subfolder/audio.mp3 --source_folder path/to/source_folder --output path/to/output
   ```

### 批处理模式

使用批处理脚本处理整个文件夹：

```
python batch_process.py --source_folder path/to/source_folder --output path/to/output [其他选项]
```

批处理脚本选项：
- `--source_folder`：源文件夹路径（必需）
- `--output`：输出文件夹路径（必需）
- `--model`：Whisper模型大小（可选）
- `--api_key`：DeepSeek API密钥（可选）
- `--template`：使用的提示词模板（可选）
- `--prompts_dir`：提示词模板目录（可选）
- `--threads`：并发处理的线程数（可选，默认为1）

示例：
```
python batch_process.py --source_folder D:\AudioFiles --output D:\ProcessedAudio --model small --threads 4
```

## 文件夹结构示例

假设源文件夹结构如下：
```
源文件夹/
├── 会议记录/
│   ├── 2023年/
│   │   ├── 1月会议.mp3
│   │   └── 2月会议.mp3
│   └── 2024年/
│       └── 1月会议.mp3
├── 课程录音/
│   ├── 数学/
│   │   ├── 第一章.mp3
│   │   └── 第二章.mp3
│   └── 英语/
│       └── 第一课.mp3
└── 个人录音/
    └── 备忘.mp3
```

处理后，输出文件夹结构将保持一致：
```
输出文件夹/
├── transcripts/
│   ├── 会议记录/
│   │   ├── 2023年/
│   │   │   ├── 1月会议_转录_20240101_120000.txt
│   │   │   └── 2月会议_转录_20240101_120500.txt
│   │   └── 2024年/
│   │       └── 1月会议_转录_20240101_121000.txt
│   ├── 课程录音/
│   │   ├── 数学/
│   │   │   ├── 第一章_转录_20240101_121500.txt
│   │   │   └── 第二章_转录_20240101_122000.txt
│   │   └── 英语/
│   │       └── 第一课_转录_20240101_122500.txt
│   └── 个人录音/
│       └── 备忘_转录_20240101_123000.txt
└── summaries/
    ├── 会议记录/
    │   ├── 2023年/
    │   │   ├── 1月会议_总结_20240101_120000.txt
    │   │   └── 2月会议_总结_20240101_120500.txt
    │   └── 2024年/
    │       └── 1月会议_总结_20240101_121000.txt
    ├── 课程录音/
    │   ├── 数学/
    │   │   ├── 第一章_总结_20240101_121500.txt
    │   │   └── 第二章_总结_20240101_122000.txt
    │   └── 英语/
    │       └── 第一课_总结_20240101_122500.txt
    └── 个人录音/
        └── 备忘_总结_20240101_123000.txt
```

## 注意事项

1. 确保有足够的磁盘空间存储转录和总结文件
2. 处理大量文件时，建议使用批处理脚本并设置适当的线程数
3. 如果源文件夹中有重复名称的文件在不同子目录中，它们会在输出中保持各自的路径结构
4. 处理过程中不要移动或修改源文件夹中的文件

## 技术实现

1. **递归扫描**：使用`os.walk()`递归遍历文件夹结构
2. **相对路径计算**：使用`os.path.relpath()`计算文件相对于源文件夹的路径
3. **目录结构创建**：在输出文件夹中创建与源文件夹相同的目录结构
4. **文件命名**：使用时间戳确保文件名唯一

## 更新日志

- 添加了对嵌套文件夹的支持
- 修改了文件扫描逻辑，使用`os.walk()`替代`os.listdir()`
- 更新了文件保存逻辑，支持保持源文件夹结构
- 添加了批处理脚本`batch_process.py`用于处理大量文件
- 更新了命令行参数，添加了`--source_folder`选项